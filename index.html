<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR Video Player - Standard Pattern</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <!-- A-Frame ã‚’èª­ã¿è¾¼ã‚€ -->
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <!-- AR.js ã‚’èª­ã¿è¾¼ã‚€ -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>
<body style='margin: 0; overflow: hidden; font-family: Arial, sans-serif;'>
    
    <!-- ã‚·ãƒ¼ãƒ³è¨­å®š -->
    <a-scene 
        embedded 
        arjs='
            trackingMethod: best; 
            sourceType: webcam; 
            debugUIEnabled: false; 
            detectionMode: mono_and_matrix; 
            matrixCodeType: 3x3; 
            patternRatio: 0.90;
            maxDetectionRate: 60;
            canvasWidth: 640;
            canvasHeight: 480;
        '
        vr-mode-ui="enabled: false"
        loading-screen="enabled: false">
        
        <a-assets>
            <!-- å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ« -->
            <video 
                id="video1" 
                src="./assets/videos/sample-3.mp4" 
                preload="auto" 
                crossorigin="anonymous" 
                webkit-playsinline 
                playsinline 
                muted 
                loop>
            </video>
        </a-assets>
        
        <!-- æ¨™æº–ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒ¼ã‚«ãƒ¼ã‚’ä½¿ç”¨ -->
        <a-marker 
            type="pattern" 
            url="./pattern-marker.patt" 
            id="pattern-marker"
            armarker>
            
            <!-- è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ -->
            <a-text 
                value="ğŸ¬ AR.js MARKER DETECTED!" 
                position="0 2.5 0" 
                align="center" 
                color="#00ffff"
                scale="2.5 2.5 2.5"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 8000">
            </a-text>
            
            <!-- å‹•ç”»è¡¨ç¤ºç”¨ã®å¹³é¢ -->
            <a-plane 
                position="0 0 0" 
                rotation="-90 0 0" 
                width="2.5" 
                height="2" 
                material="src: #video1; transparent: false; side: double;">
            </a-plane>
            
            <!-- è£…é£¾çš„ãª3Dã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ -->
            <a-box 
                position="0 1.5 0" 
                color="#ff4444" 
                scale="0.4 0.4 0.4"
                animation="property: rotation; to: 360 360 360; loop: true; dur: 3000">
            </a-box>
            
            <a-cylinder 
                position="-1.5 0.8 0" 
                color="#44ff44" 
                radius="0.2" 
                height="0.6"
                animation="property: position; to: 1.5 0.8 0; direction: alternate; loop: true; dur: 4000">
            </a-cylinder>
            
            <a-sphere 
                position="1.5 0.8 0" 
                color="#4444ff" 
                radius="0.25"
                animation="property: scale; to: 1.5 1.5 1.5; direction: alternate; loop: true; dur: 2000">
            </a-sphere>
            
            <!-- è¿½åŠ ã®è¦–è¦šè¦ç´  -->
            <a-torus 
                position="0 1 1" 
                color="#ffff44" 
                radius="0.3" 
                radius-tubular="0.1"
                animation="property: rotation; to: 360 0 360; loop: true; dur: 5000">
            </a-torus>
            
        </a-marker>
        
        <!-- ã‚«ãƒ¡ãƒ© -->
        <a-entity camera></a-entity>
    </a-scene>

    <!-- UI ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
    <div id="ui-panel" style="position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.85); color: white; padding: 20px; border-radius: 12px; max-width: 350px; z-index: 1000; font-size: 13px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
        <h3 style="margin: 0 0 15px 0; color: #00ffff; font-size: 18px;">ğŸ¬ AR Video Player</h3>
        
        <!-- ãƒ¡ã‚¤ãƒ³çŠ¶æ…‹è¡¨ç¤º -->
        <div style="margin: 15px 0; padding: 12px; background: rgba(255,255,255,0.1); border-radius: 8px;">
            <div style="margin: 5px 0;">
                <strong>ğŸ¯ Marker Status:</strong> 
                <span id="marker-status" style="color: #ffeb3b; font-weight: bold;">æ¤œç´¢ä¸­...</span>
            </div>
            <div style="margin: 5px 0;">
                <strong>ğŸ¬ Video Status:</strong> 
                <span id="video-status" style="color: #2196f3;">æº–å‚™ä¸­...</span>
            </div>
        </div>
        
        <!-- çµ±è¨ˆæƒ…å ± -->
        <div style="margin: 15px 0; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 6px;">
            <div style="display: flex; justify-content: space-between; font-size: 12px;">
                <span>æ¤œå‡ºå›æ•°: <strong id="found-count" style="color: #4caf50;">0</strong></span>
                <span>æ¶ˆå¤±å›æ•°: <strong id="lost-count" style="color: #f44336;">0</strong></span>
            </div>
            <div style="margin-top: 8px; font-size: 11px; color: #aaaaaa;">
                æœ€æ–°æ¤œå‡º: <span id="last-detection">æœªæ¤œå‡º</span>
            </div>
        </div>
        
        <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ -->
        <div style="margin: 15px 0; text-align: center;">
            <button id="play-video" style="padding: 10px 15px; background: #4CAF50; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; margin: 3px; font-weight: bold;">â–¶ å‹•ç”»å†ç”Ÿ</button>
            <button id="pause-video" style="padding: 10px 15px; background: #ff9800; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; margin: 3px;">â¸ ä¸€æ™‚åœæ­¢</button>
            <button id="restart" style="padding: 10px 15px; background: #f44336; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; margin: 3px;">ğŸ”„ å†èµ·å‹•</button>
        </div>
        
        <!-- éŸ³é‡èª¿æ•´ -->
        <div style="margin: 15px 0;">
            <label style="font-size: 12px; color: #cccccc;">ğŸ”Š éŸ³é‡: </label>
            <input id="volume-control" type="range" min="0" max="1" step="0.1" value="0.8" style="width: 120px; margin: 0 8px;">
            <span id="volume-display" style="font-size: 11px; color: #cccccc;">80%</span>
        </div>
        
        <!-- ä½¿ç”¨æ–¹æ³• -->
        <div style="margin: 15px 0; padding: 10px; background: rgba(33, 150, 243, 0.15); border-radius: 6px; border-left: 3px solid #2196f3;">
            <div style="font-size: 11px; color: #e3f2fd; line-height: 1.4;">
                <strong>ğŸ“± ä½¿ç”¨æ–¹æ³•:</strong><br>
                â€¢ pattern-marker.png ã‚’ã‚«ãƒ¡ãƒ©ã«æ˜ ã™<br>
                â€¢ ãƒãƒ¼ã‚«ãƒ¼ã‹ã‚‰ 40-60cm ã®è·é›¢<br>
                â€¢ ãƒãƒ¼ã‚«ãƒ¼å…¨ä½“ãŒãƒ•ãƒ¬ãƒ¼ãƒ å†…ã«å…¥ã‚‹ã‚ˆã†ã«<br>
                â€¢ ååˆ†æ˜ã‚‹ã„ç’°å¢ƒã§ä½¿ç”¨
            </div>
        </div>
    </div>

    <script>
        let foundCount = 0;
        let lostCount = 0;
        let currentVideo = null;
        let isMarkerVisible = false;

        // ãƒãƒ¼ã‚«ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
        AFRAME.registerComponent('armarker', {
            init: function () {
                const el = this.el;
                console.log('ğŸš€ AR Marker component initialized for pattern-marker.patt');
                
                // ãƒãƒ¼ã‚«ãƒ¼æ¤œå‡ºã‚¤ãƒ™ãƒ³ãƒˆ
                el.addEventListener('markerFound', function() {
                    foundCount++;
                    isMarkerVisible = true;
                    
                    const now = new Date().toLocaleTimeString();
                    console.log(`âœ… PATTERN MARKER DETECTED! Count: ${foundCount} at ${now}`);
                    
                    // UIæ›´æ–°
                    updateUI('marker-status', 'ğŸ¯ ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒ¼ã‚«ãƒ¼æ¤œå‡ºä¸­!', '#4caf50');
                    document.getElementById('found-count').textContent = foundCount;
                    document.getElementById('last-detection').textContent = now;
                    
                    // å‹•ç”»å†ç”Ÿï¼ˆå°‘ã—é…å»¶ã‚’å…¥ã‚Œã¦å®‰å®šåŒ–ï¼‰
                    setTimeout(() => {
                        if (isMarkerVisible && currentVideo) {
                            playVideo();
                        }
                    }, 500);
                });

                // ãƒãƒ¼ã‚«ãƒ¼æ¶ˆå¤±ã‚¤ãƒ™ãƒ³ãƒˆ
                el.addEventListener('markerLost', function() {
                    lostCount++;
                    isMarkerVisible = false;
                    
                    console.log(`âŒ PATTERN MARKER LOST! Count: ${lostCount}`);
                    
                    // UIæ›´æ–°
                    updateUI('marker-status', 'âŒ ãƒãƒ¼ã‚«ãƒ¼æ¶ˆå¤±', '#f44336');
                    document.getElementById('lost-count').textContent = lostCount;
                    
                    // å‹•ç”»åœæ­¢ï¼ˆ2ç§’ã®çŒ¶äºˆï¼‰
                    setTimeout(() => {
                        if (!isMarkerVisible && currentVideo) {
                            pauseVideo();
                        }
                    }, 2000);
                });
            }
        });

        // UIæ›´æ–°ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function updateUI(elementId, text, color) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = text;
                element.style.color = color;
            }
        }

        // å‹•ç”»å†ç”Ÿé–¢æ•°
        function playVideo() {
            if (!currentVideo) {
                console.error('âŒ Video element not found');
                return;
            }
            
            currentVideo.muted = false; // ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤
            currentVideo.currentTime = 0;
            
            currentVideo.play().then(() => {
                console.log('âœ… Video playback started');
                updateUI('video-status', 'â–¶ å†ç”Ÿä¸­', '#4caf50');
            }).catch(error => {
                console.error('âŒ Video playback failed:', error);
                updateUI('video-status', 'âŒ å†ç”Ÿã‚¨ãƒ©ãƒ¼', '#f44336');
                
                // æ‰‹å‹•å†ç”Ÿã‚’ä¿ƒã™
                showManualPlayPrompt();
            });
        }

        // å‹•ç”»ä¸€æ™‚åœæ­¢é–¢æ•°
        function pauseVideo() {
            if (currentVideo) {
                currentVideo.pause();
                console.log('â¸ Video paused');
                updateUI('video-status', 'â¸ ä¸€æ™‚åœæ­¢', '#ff9800');
            }
        }

        // æ‰‹å‹•å†ç”Ÿãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
        function showManualPlayPrompt() {
            if (document.getElementById('manual-play-prompt')) return; // é‡è¤‡é˜²æ­¢
            
            const prompt = document.createElement('div');
            prompt.id = 'manual-play-prompt';
            prompt.innerHTML = `
                <div style="text-align: center;">
                    <h3 style="margin: 0 0 15px 0; color: #00ffff;">ğŸ¬ å‹•ç”»ã‚’æ‰‹å‹•ã§å†ç”Ÿ</h3>
                    <p style="margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        ãƒ–ãƒ©ã‚¦ã‚¶ã®åˆ¶é™ã«ã‚ˆã‚Šè‡ªå‹•å†ç”Ÿã§ãã¾ã›ã‚“<br>
                        æ‰‹å‹•ã§å†ç”Ÿãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„
                    </p>
                    <button id="manual-play-btn" style="padding: 15px 25px; background: #4CAF50; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; font-weight: bold;">â–¶ å†ç”Ÿé–‹å§‹</button>
                </div>
            `;
            prompt.style.cssText = `
                position: fixed; 
                top: 50%; 
                left: 50%; 
                transform: translate(-50%, -50%); 
                z-index: 3000; 
                padding: 30px; 
                background: rgba(0,0,0,0.95); 
                color: white;
                border-radius: 15px; 
                font-family: Arial, sans-serif; 
                max-width: 400px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.7);
                border: 2px solid #00ffff;
            `;
            
            document.body.appendChild(prompt);
            
            // æ‰‹å‹•å†ç”Ÿãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
            document.getElementById('manual-play-btn').addEventListener('click', function() {
                currentVideo.muted = false;
                currentVideo.play().then(() => {
                    updateUI('video-status', 'â–¶ å†ç”Ÿä¸­', '#4caf50');
                    document.body.removeChild(prompt);
                    console.log('âœ… Manual video playback started');
                }).catch(error => {
                    console.error('âŒ Manual playback failed:', error);
                    alert('å‹•ç”»ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                });
            });
            
            // 15ç§’å¾Œã«è‡ªå‹•å‰Šé™¤
            setTimeout(() => {
                if (document.body.contains(prompt)) {
                    document.body.removeChild(prompt);
                }
            }, 15000);
        }

        // åˆæœŸåŒ–å‡¦ç†
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ AR Video Player with pattern-marker.patt starting...');
            
            // å‹•ç”»è¦ç´ ã®å–å¾—ã¨è¨­å®š
            currentVideo = document.querySelector('#video1');
            if (currentVideo) {
                currentVideo.volume = 0.8;
                
                // å‹•ç”»ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
                currentVideo.addEventListener('loadeddata', () => {
                    console.log('âœ… Video data loaded successfully');
                    updateUI('video-status', 'âœ… æº–å‚™å®Œäº†', '#4caf50');
                });
                
                currentVideo.addEventListener('canplay', () => {
                    console.log('âœ… Video ready to play');
                });
                
                currentVideo.addEventListener('error', (e) => {
                    console.error('âŒ Video loading error:', e);
                    updateUI('video-status', 'âŒ èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼', '#f44336');
                });
                
                currentVideo.addEventListener('ended', () => {
                    console.log('ğŸ”„ Video ended, looping...');
                    if (isMarkerVisible) {
                        currentVideo.currentTime = 0;
                        currentVideo.play();
                    }
                });
            } else {
                console.error('âŒ Video element not found');
                updateUI('video-status', 'âŒ å‹•ç”»æœªç™ºè¦‹', '#f44336');
            }
            
            // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã®è¨­å®š
            setupControls();
            
            console.log('âœ… AR Video Player initialization complete');
        });

        // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ã®è¨­å®š
        function setupControls() {
            // æ‰‹å‹•å†ç”Ÿãƒœã‚¿ãƒ³
            document.getElementById('play-video').addEventListener('click', () => {
                playVideo();
            });
            
            // ä¸€æ™‚åœæ­¢ãƒœã‚¿ãƒ³
            document.getElementById('pause-video').addEventListener('click', () => {
                pauseVideo();
            });
            
            // å†èµ·å‹•ãƒœã‚¿ãƒ³
            document.getElementById('restart').addEventListener('click', () => {
                location.reload();
            });
            
            // éŸ³é‡èª¿æ•´
            const volumeControl = document.getElementById('volume-control');
            const volumeDisplay = document.getElementById('volume-display');
            
            volumeControl.addEventListener('input', function() {
                const volume = parseFloat(this.value);
                if (currentVideo) {
                    currentVideo.volume = volume;
                    currentVideo.muted = (volume === 0);
                }
                volumeDisplay.textContent = Math.round(volume * 100) + '%';
            });
        }
    </script>
</body>
</html>